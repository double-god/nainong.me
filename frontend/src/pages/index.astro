---
// 1. 引入 SDK
import PocketBase from 'pocketbase';

// 2. 连接到后端（服务端渲染与开发环境区分）
// 如果是在生产（Docker 内）则使用内部服务名 `backend`，否则使用本地回环地址
const dbUrl = import.meta.env.PROD
  ? 'http://backend:8090'
  : 'http://127.0.0.1:8090';

const pb = new PocketBase(dbUrl);

// 3. 抓取数据（带调试输出，帮助排查在容器内使用的地址）
console.log("正在连接数据库地址:", dbUrl);
let posts = [];
try {
  posts = await pb.collection('posts').getFullList({
    sort: '-created', // 按创建时间倒序排
  });
  console.log("成功获取到数据:", posts.length, "条");
} catch (e) {
  console.error("获取数据失败，详细错误:", e.originalError || e);
}
---

<html lang="zh-cn">
  <head>
    <meta charset="utf-8" />
    <title>我的 PocketBase 博客</title>
    <meta name="viewport" content="width=device-width" />
  </head>
  <body>
    <div style="max-width: 800px; margin: 0 auto; padding: 20px;">
      <h1>欢迎来到我的博客</h1>
      <p>下面这些内容是从 PocketBase 数据库里实时读取的：</p>
      
      <div class="blog-list">
        {posts.map((post) => (
          <article style="border: 1px solid #ccc; margin: 20px 0; padding: 20px; border-radius: 8px;">
            <h2 style="margin-top: 0;">{post.title}</h2>
            <div set:html={post.content}></div>
            <p style="color: #666; font-size: 0.9em;">
              发布时间: {new Date(post.created).toLocaleString()}
            </p>
          </article>
        ))}
      </div>

      {posts.length === 0 && <p>暂时没有文章，博主在偷懒。</p>}
    </div>
  </body>
</html>