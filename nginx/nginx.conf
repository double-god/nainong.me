server {
    listen 80;

    # 使用 ^~ 确保优先级高于任何正则表达式
    location ^~ /_astro/ {
        proxy_pass http://blog-frontend:80;
        proxy_set_header Host $host;
        # 彻底禁用缓存，解决哈希文件名变动导致的 404
        expires -1;
        add_header Cache-Control "no-store, no-cache, must-revalidate";
    }

    # 后端 API：仅匹配特定的后端路径，避免误伤
    location ~ ^/(api|_admin|_schema) {
        proxy_pass http://blog-backend:8090;
        proxy_set_header Host $host;
    }

    # 默认前端页面
    location / {
        proxy_pass http://blog-frontend:80;
        proxy_set_header Host $host;
    }
}